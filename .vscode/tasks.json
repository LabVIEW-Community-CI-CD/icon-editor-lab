{
  "version": "2.0.0",
  "tasks": [
    {
      "label": "Local CI: Windows (all stages)",
      "type": "shell",
      "command": "pwsh",
      "args": [
        "-NoLogo",
        "-NoProfile",
        "-File",
        "local-ci/windows/Invoke-LocalCI.ps1"
      ],
      "problemMatcher": []
    },
    {
      "label": "Local CI: Ubuntu (handshake stages)",
      "type": "shell",
      "command": "bash",
      "args": [
        "local-ci/ubuntu/invoke-local-ci.sh",
        "--skip",
        "28-docs",
        "--skip",
        "30-tests"
      ],
      "problemMatcher": []
    },
    {
      "label": "Local CI: Ubuntu (docker runner)",
      "type": "shell",
      "command": "bash",
      "args": [
        "-lc",
        "docker run --rm -v ${workspaceFolder}:/work icon-editor-lab/ubuntu-runner:local-ci localci-run-handshake --skip 28-docs --skip 30-tests"
      ],
      "problemMatcher": []
    },
    {
      "label": "Tests: IconEditor DevMode coverage",
      "type": "shell",
      "command": "pwsh",
      "args": [
        "-NoLogo",
        "-NoProfile",
        "-File",
        "${workspaceFolder}/src/Invoke-PesterTests.ps1",
        "-Tag",
        "icon-editor"
      ],
      "problemMatcher": []
    },
    {
      "label": "Local CI: Stage 25 DevMode (enable)",
      "type": "shell",
      "command": "pwsh",
      "args": [
        "-NoLogo",
        "-NoProfile",
        "-File",
        "tests/tools/Run-DevMode-Debug.ps1",
        "-Action",
        "Enable"
      ],
      "problemMatcher": []
    },
    {
      "label": "Local CI: Stage 25 DevMode (disable)",
      "type": "shell",
      "command": "pwsh",
      "args": [
        "-NoLogo",
        "-NoProfile",
        "-File",
        "tests/tools/Run-DevMode-Debug.ps1",
        "-Action",
        "Disable"
      ],
      "problemMatcher": []
    },
    {
      "label": "Local CI: Stage 25 DevMode (debug)",
      "type": "shell",
      "command": "pwsh",
      "args": [
        "-NoLogo",
        "-NoProfile",
        "-File",
        "tests/tools/Run-DevMode-Debug.ps1"
      ],
      "problemMatcher": []
    },
    {
      "label": "Local CI: Show last DevMode run",
      "type": "shell",
      "command": "pwsh",
      "args": [
        "-NoLogo",
        "-NoProfile",
        "-File",
        "tests/tools/Show-LastDevModeRun.ps1"
      ],
      "problemMatcher": []
    },
    {
      "label": "DevMode: Review last run (human gate)",
      "type": "shell",
      "command": "pwsh",
      "args": [
        "-NoLogo",
        "-NoProfile",
        "-File",
        "tests/tools/Verify-DevModeLog.ps1",
        "-PromptReview"
      ],
      "problemMatcher": []
    },
    {
      "label": "Local CI: Stage 25 DevMode (enable + review)",
      "dependsOn": [
        "Local CI: Stage 25 DevMode (enable)",
        "DevMode: Review last run (human gate)"
      ],
      "dependsOrder": "sequence",
      "problemMatcher": []
    },
    {
      "label": "Local CI: Stage 25 DevMode (disable + review)",
      "dependsOn": [
        "Local CI: Stage 25 DevMode (disable)",
        "DevMode: Review last run (human gate)"
      ],
      "dependsOrder": "sequence",
      "problemMatcher": []
    },
    {
      "label": "LvAddon: Run learning loop",
      "type": "shell",
      "command": "pwsh",
      "args": [
        "-NoLogo",
        "-NoProfile",
        "-File",
        "tests/tools/Run-LvAddonLearningLoop.ps1"
      ],
      "problemMatcher": []
    },
    {
      "label": "LvAddon: Collect learning data (XCliSim)",
      "type": "shell",
      "command": "pwsh",
      "args": [
        "-NoLogo",
        "-NoProfile",
        "-File",
        "tests/tools/Collect-LvAddonLearningData.ps1"
      ],
      "problemMatcher": []
    },
    {
      "label": "LvAddon: Show learning snippet",
      "type": "shell",
      "command": "pwsh",
      "args": [
        "-NoLogo",
        "-NoProfile",
        "-File",
        "tests/tools/Show-LvAddonLearningSnippet.ps1"
      ],
      "problemMatcher": []
    },
    {
      "label": "SemVer: Export Bundle",
      "type": "shell",
      "command": "pwsh",
      "args": [
        "-NoLogo",
        "-NoProfile",
        "-File",
        "tools/Export-SemverBundle.ps1",
        "-IncludeWorkflow",
        "-GenerateIssueTemplate",
        "-Zip"
      ],
      "problemMatcher": []
    },
    {
      "label": "SemVer: Verify Bundle",
      "type": "shell",
      "command": "pwsh",
      "args": [
        "-NoLogo",
        "-NoProfile",
        "-Command",
        "$bundle = pwsh -NoLogo -NoProfile -File tools/Get-LatestSemverBundle.ps1; if (-not $bundle) { throw '[SVB300] No SemVer bundle available. Run \"SemVer: Export Bundle\" first.' } else { pwsh -NoLogo -NoProfile -File tools/Verify-SemverBundle.ps1 -BundlePath $bundle.BundleRoot; pwsh -NoLogo -NoProfile -File tools/Write-SemverSummary.ps1 -BundleRoot $bundle.BundleRoot -WriteHost }"
      ],
      "problemMatcher": []
    },
    {
      "label": "SemVer: Export & Verify",
      "dependsOn": [
        "SemVer: Export Bundle",
        "SemVer: Verify Bundle"
      ],
      "dependsOrder": "sequence",
      "problemMatcher": []
    },
    {
      "label": "Tools: Build x-cli",
      "type": "shell",
      "command": "dotnet",
      "args": [
        "publish",
        "${workspaceFolder}/tools/x-cli-develop/src/XCli/XCli.csproj",
        "-c",
        "Release",
        "-o",
        "${workspaceFolder}/out/xcli"
      ],
      "problemMatcher": []
    },
    {
      "label": "Tools: Package x-cli",
      "type": "shell",
      "command": "pwsh",
      "args": [
        "-NoLogo",
        "-NoProfile",
        "-Command",
        "Write-Host \"[[xcli]] Packaging published binary from ${workspaceFolder}/out/xcli to artifacts/xcli-win-x64.zip\"; New-Item -ItemType Directory -Force -Path ${workspaceFolder}/artifacts | Out-Null; Compress-Archive -Path ${workspaceFolder}/out/xcli/* -DestinationPath ${workspaceFolder}/artifacts/xcli-win-x64.zip -Force; Get-Item ${workspaceFolder}/artifacts/xcli-win-x64.zip | Select-Object FullName, Length"
      ],
      "dependsOn": [
        "Tools: Build x-cli"
      ],
      "problemMatcher": []
    },
    {
      "label": "Tools: Stage x-cli artifact",
      "type": "shell",
      "command": "pwsh",
      "args": [
        "-NoLogo",
        "-NoProfile",
        "-File",
        "${workspaceFolder}/tools/Stage-XCliArtifact.ps1",
        "-RepoRoot",
        "${workspaceFolder}",
        "-ArtifactPath",
        "${workspaceFolder}/artifacts/xcli-win-x64.zip",
        "-Channel",
        "${input:xcliStageChannel}",
        "-Overwrite"
      ],
      "dependsOn": [
        "Tools: Package x-cli"
      ],
      "problemMatcher": []
    },
    {
      "label": "Tools: Validate x-cli release asset",
      "type": "shell",
      "command": "pwsh",
      "args": [
        "-NoLogo",
        "-NoProfile",
        "-File",
        "${workspaceFolder}/tools/Test-XCliReleaseAsset.ps1",
        "-RepoRoot",
        "${workspaceFolder}"
      ],
      "options": {
        "env": {
          "XCLI_STAGE_CHANNEL": "${input:xcliStageChannel}"
        }
      },
      "dependsOn": [
        "Tools: Stage x-cli artifact"
      ],
      "problemMatcher": []
    },
    {
      "label": "Tools: Promote x-cli to QA",
      "type": "shell",
      "command": "pwsh",
      "args": [
        "-NoLogo",
        "-NoProfile",
        "-File",
        "${workspaceFolder}/tools/Promote-XCliArtifact.ps1",
        "-RepoRoot",
        "${workspaceFolder}"
      ],
      "options": {
        "env": {
          "XCLI_STAGE_CHANNEL": "${input:xcliStageChannel}",
          "XCLI_QA_DESTINATION": "${input:xcliQaDestination}"
        }
      },
      "dependsOn": [
        "Tools: Validate x-cli release asset"
      ],
      "problemMatcher": []
    },
    {
      "label": "Tools: Upload x-cli artifact",
      "type": "shell",
      "command": "pwsh",
      "args": [
        "-NoLogo",
        "-NoProfile",
        "-File",
        "${workspaceFolder}/tools/Upload-XCliArtifact.ps1",
        "-RepoRoot",
        "${workspaceFolder}",
        "-Mode",
        "${input:xcliUploadMode}",
        "-ReleaseRepo",
        "${input:xcliReleaseRepo}",
        "-ReleaseTag",
        "${input:xcliReleaseTag}",
        "-DestinationFolder",
        "${input:xcliDestinationFolder}",
        "-DestinationFileName",
        "${input:xcliFolderFileName}"
      ],
      "options": {
        "env": {
          "XCLI_STAGE_CHANNEL": "${input:xcliStageChannel}"
        }
      },
      "dependsOn": [
        "Tools: Promote x-cli to QA"
      ],
      "problemMatcher": []
    },
    {
      "label": "Tools: Publish x-cli",
      "dependsOn": [
        "Tools: Build x-cli",
        "Tools: Package x-cli",
        "Tools: Stage x-cli artifact",
        "Tools: Validate x-cli release asset",
        "Tools: Promote x-cli to QA",
        "Tools: Upload x-cli artifact"
      ],
      "dependsOrder": "sequence",
      "command": "pwsh",
      "args": [
        "-NoLogo",
        "-NoProfile",
        "-Command",
        "Write-Host \"[[xcli]] Build → package → stage → validate → QA → upload complete.\""
      ],
      "problemMatcher": []
    }
  ],
  "inputs": [
    {
      "id": "xcliStageChannel",
      "type": "promptString",
      "description": "Channel name for staging (e.g., local/dev/qa)",
      "default": "local"
    },
    {
      "id": "xcliQaDestination",
      "type": "promptString",
      "description": "Destination folder for QA promotion (relative paths allowed)",
      "default": ".tmp-tests/xcli-qa"
    },
    {
      "id": "xcliUploadMode",
      "type": "pickString",
      "description": "Upload target for staged artifact",
      "options": [
        {
          "label": "GitHub release (dry-run)",
          "value": "github"
        },
        {
          "label": "Folder copy",
          "value": "folder"
        }
      ],
      "default": "folder"
    },
    {
      "id": "xcliReleaseRepo",
      "type": "promptString",
      "description": "GitHub release repository (owner/name)",
      "default": "svelderrainruiz/icon-editor-lab"
    },
    {
      "id": "xcliReleaseTag",
      "type": "promptString",
      "description": "Optional release tag override (leave blank to use stage timestamp)",
      "default": ""
    },
    {
      "id": "xcliDestinationFolder",
      "type": "promptString",
      "description": "Folder for upload mode 'folder'",
      "default": "C:\\\\Shared\\\\xcli-artifacts"
    },
    {
      "id": "xcliFolderFileName",
      "type": "promptString",
      "description": "Optional file name override when copying to a folder (leave blank to keep zip name)",
      "default": ""
    }
  ]

}
