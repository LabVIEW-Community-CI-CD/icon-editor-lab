# ADR-0002 - Adopt enforceable coverage + doc-link gates

## Status

Accepted 2025-11-14

## Context

Windows-hosted Pester runs already exist but their outputs were advisory. Link rot reports surfaced intermittently, yet we lacked persistent artifacts to diagnose failures. Leadership requested a release-candidate gate that proves at least 75% total line coverage, keeps critical PowerShell modules above the same floor, and captures link-check evidence before publishing docs updates.

## Decision

Update `.github/workflows/coverage.yml` so a Windows runner installs Pester >=6, writes Cobertura + JUnit results to `artifacts/coverage/coverage.xml` and `artifacts/test-results/results.xml`, enforces >=75% total coverage, and validates per-file coverage for `src/tools/IconEditorPackage.psm1` and `src/tools/CompareVI.Tools/CompareVI.Tools.psm1` when present. Update `.github/workflows/docs-link-check.yml` to keep using `lycheeverse/lychee-action@v1` on Ubuntu with retry/timeout flags and to upload the `.lychee` report as an artifact on every run.

## Consequences

- Coverage regressions will fail CI loudly before merges or releases and provide downloadable Cobertura + JUnit evidence.
- Critical modules must maintain >=75% coverage or justify exemptions via future ADRs.
- Lychee continues to guard documentation URLs, and every failure leaves behind the `.lychee` report for auditing even when the check fails early.

## References

- `.github/workflows/coverage.yml`
- `.github/workflows/docs-link-check.yml`
